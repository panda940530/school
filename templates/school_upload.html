<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>è¨ˆç•«æŸ¥è©¢å…¥å£</title>
  <style>
    :root{
      --bg:#fafafa;
      --card:#ffffff;
      --text:#333;
      --muted:#666;
      --border:#e5e5e5;
      --primary:#4CAF50;
      --primary-hover:#43a047;
      --shadow:0 2px 8px rgba(0,0,0,.08);
      --radius:10px;
    }
    *{box-sizing:border-box;}
    body{
      font-family:"Microsoft JhengHei", ui-sans-serif, system-ui;
      background:var(--bg);
      margin:0;
      padding:2rem;
      display:flex;
      justify-content:center;
    }
    .container{
      max-width:780px;
      width:100%;
    }
    h1{
      margin:0 0 .5rem;
      color:var(--text);
      font-size:1.6rem;
    }
    p.subtitle{
      margin:.1rem 0 1.5rem;
      color:var(--muted);
      font-size:.95rem;
    }
    .card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:1.25rem 1.5rem 1.5rem;
    }
    label{
      display:block;
      font-weight:600;
      margin-bottom:.4rem;
      color:var(--text);
    }
    textarea{
      width:100%;
      min-height:120px;
      resize:vertical;
      padding:.7rem .8rem;
      border-radius:8px;
      border:1px solid var(--border);
      font-family:inherit;
      font-size:.98rem;
      line-height:1.5;
    }
    textarea:focus{
      outline:none;
      border-color:var(--primary);
      box-shadow:0 0 0 2px rgba(76,175,80,.15);
    }
    .color-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
      gap:.75rem;
      margin-top:1rem;
    }
    .color-field{
      display:flex;
      align-items:center;
      gap:.4rem;
      padding:.55rem .65rem;
      border:1px solid var(--border);
      border-radius:8px;
      background:#fafafa;
    }
    .color-field label{
      margin:0;
      font-weight:500;
      font-size:.9rem;
      min-width:64px;
      color:var(--muted);
    }
    .color-field input[type="color"]{
      width:44px;
      height:32px;
      padding:0;
      border:none;
      background:transparent;
      cursor:pointer;
    }
    .voice-row{
      display:flex;
      align-items:center;
      gap:.5rem;
      margin-top:.75rem;
    }
    .voice-status{
      color:var(--muted);
      font-size:.9rem;
    }
    .hint{
      margin-top:.4rem;
      color:var(--muted);
      font-size:.85rem;
      line-height:1.4;
    }
    .examples{
      margin-top:.6rem;
      padding:.6rem .8rem;
      background:#f7f7f7;
      border-radius:8px;
      font-size:.85rem;
      color:var(--muted);
    }
    .examples div{
      margin-top:.1rem;
    }
    button{
      margin-top:1rem;
      background:var(--primary);
      color:#fff;
      border:none;
      border-radius:8px;
      padding:.6rem 1.4rem;
      cursor:pointer;
      font-size:1rem;
    }
    button:hover{
      background:var(--primary-hover);
    }
    .n8n-info{
      margin-top:1rem;
      font-size:.8rem;
      color:var(--muted);
    }
    code{
      background:#f3f3f3;
      padding:2px 6px;
      border-radius:4px;
      word-break:break-all;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>è¨ˆç•«æŸ¥è©¢å…¥å£</h1>
    <p class="subtitle">è¼¸å…¥è‡ªç„¶èªè¨€éœ€æ±‚ï¼Œç”± n8n é€£åˆ°è³‡æ–™åº«æŸ¥è©¢ä¸¦å›å‚³ AI è§£èªªã€‚</p>

    <div class="card">
      <form method="post">
        <label for="query">è«‹è¼¸å…¥æŸ¥è©¢å…§å®¹ï¼ˆè‡ªç„¶èªè¨€ï¼‰</label>
        <textarea id="query" name="query" placeholder="ä¾‹å¦‚ï¼š&#10;è«‹å½™æ•´è¿‘ä¸‰å¹´åº¦æ ¸å®šé‡‘é¡èˆ‡ä»¶æ•¸&#10;è«‹å¹«æˆ‘æ•´ç†å„å­¸é™¢è¿‘äº”å¹´è¨ˆç•«ä»¶æ•¸çš„ç¸½è¶¨å‹¢" required></textarea>
        <div class="hint">é€å‡ºå¾Œç”± Flask è½‰é€åˆ° n8n Webhookï¼Œn8n æœƒè·‘ SQL / æŸ¥è©¢ï¼Œçµæœè¡¨æ ¼èˆ‡ AI èªªæ˜æœƒå‘ˆç¾ã€‚</div>
        <div class="examples">
          <strong>ç¯„ä¾‹</strong>
          <div>è«‹çµ±è¨ˆè¿‘ä¸‰å¹´åº¦æ ¸å®šé‡‘é¡èˆ‡ç¸½ä»¶æ•¸</div>
          <div>è«‹çµ±è¨ˆç›®å‰åŸ·è¡Œä¸­è¨ˆç•«ä»¶æ•¸èˆ‡ç¸½é‡‘é¡</div>
        </div>
        <div class="voice-row">
          <button type="button" id="voiceBtn" style="background:#ff9800;">ğŸ¤ èªéŸ³è¼¸å…¥</button>
          <span id="voiceStatus" class="voice-status"></span>
        </div>
        {% set colors = default_bar_colors or ['#f57c00','#2e7d32','#1976d2','#7b1fa2'] %}
        <div class="color-grid">
          <div class="color-field">
            <label for="color1">é¡è‰² 1</label>
            <input type="color" id="color1" name="color1" value="{{ colors[0] }}">
          </div>
          <div class="color-field">
            <label for="color2">é¡è‰² 2</label>
            <input type="color" id="color2" name="color2" value="{{ colors[1] }}">
          </div>
          <div class="color-field">
            <label for="color3">é¡è‰² 3</label>
            <input type="color" id="color3" name="color3" value="{{ colors[2] }}">
          </div>
          <div class="color-field">
            <label for="color4">é¡è‰² 4</label>
            <input type="color" id="color4" name="color4" value="{{ colors[3] }}">
          </div>
        </div>
        <button type="submit">é€å‡ºæŸ¥è©¢</button>
      </form>
      <div class="n8n-info">
        n8n Webhook URLï¼š<code>{{ n8n_url }}</code>
      </div>
    </div>
  </div>
</body>
<script>
  (() => {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const btn = document.getElementById('voiceBtn');
    const statusEl = document.getElementById('voiceStatus');
    const textarea = document.getElementById('query');

    if (!SpeechRecognition) {
      if (btn) btn.disabled = true;
      if (statusEl) statusEl.textContent = 'æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¼¸å…¥';
      return;
    }

    const recognition = new SpeechRecognition();
    recognition.lang = 'zh-TW';
    recognition.interimResults = false;
    recognition.continuous = false;

    let listening = false;

    recognition.onstart = () => {
      listening = true;
      btn.textContent = 'åœæ­¢éŒ„éŸ³';
      btn.style.background = '#e53935';
      statusEl.textContent = 'éŒ„éŸ³ä¸­â€¦è«‹é–‹å§‹èªªè©±';
    };
    recognition.onend = () => {
      listening = false;
      btn.textContent = 'ğŸ¤ èªéŸ³è¼¸å…¥';
      btn.style.background = '#ff9800';
      statusEl.textContent = '';
    };
    recognition.onerror = (e) => {
      statusEl.textContent = 'éŒ„éŸ³éŒ¯èª¤ï¼š' + (e.error || '');
    };
    recognition.onresult = (e) => {
      const text = Array.from(e.results).map(r => r[0].transcript).join('');
      if (text && textarea) {
        textarea.value = (textarea.value ? textarea.value + '\n' : '') + text.trim();
      }
    };

    btn.addEventListener('click', () => {
      if (!listening) recognition.start();
      else recognition.stop();
    });
  })();
</script>
</html>
